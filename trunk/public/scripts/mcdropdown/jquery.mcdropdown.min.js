(function($){$.fn.mcDropdown=function(a,b){var c;this.each(function(){c=$.data(this,"mcDropdown");if(c){return false}new $.mcDropDownMenu(this,a,b)});return c||this};$.mcDropdown={version:"1.2.07",setDefaults:function(a){$.extend(C,a)}};var C={minRows:8,maxRows:25,targetColumnSize:2,openFx:"slideDown",openSpeed:250,closeFx:"slideUp",closeSpeed:250,hoverOverDelay:200,hoverOutDelay:0,showFx:"show",showSpeed:0,hideFx:"hide",hideSpeed:0,dropShadow:true,autoHeight:true,lineHeight:19,screenPadding:10,allowParentSelect:false,delim:":",showACOnEmptyFocus:false,valueAttr:"rel",click:null,select:null,init:null};var D=($.browser.version&&$.browser.version<=6);$.mcDropDownMenu=function(t,u,v){var w,thismenu=this,$list,$divInput,settings,typedText="",matchesCache,oldCache,$keylist,$keylistiframe,bInput,bDisabled=false;w=$(t);bInput=w.is(":input");settings=$.extend({},C,v);if(settings.click==null){settings.click=function(e,a,b){a.setValue(this.attr(b.valueAttr))}}$(document).bind("click",function(e){var a=$(e.target);var b=a.parents().filter(function(){return this===$list[0]||(!!$keylist&&$keylist[0]===this)});if(b.length){var c=a.is(".mc_parent");if(c&&$keylist&&b[0]===$keylist[0]){clearTimeout(B);updateValue(a.find("> ul > li:first"),false);e.stopPropagation();return false}else{if(!settings.allowParentSelect&&c){return false}}if(a.not(".mc_root")){hideBranch.apply(a.parent().parent()[0],[e])}if(settings.click!=null&&settings.click.apply(a,[e,thismenu,settings])==false){return false}}thismenu.closeMenu()});$list=(((typeof u=="object")&&!!u.jquery))?u:$(u);$list.appendTo("body").css({position:"absolute",top:-10000,left:-10000}).find("ul").andSelf().css("display","block").each(function(){var a=$(this);a.data("width",a[0].clientWidth)}).css({top:0,left:0,display:"none"});$list.find("> li").addClass("mc_root");$("li > ul",$list).parent().addClass("mc_parent");$divInput=$('<div class="mcdropdown"><a href="#" tabindex="-1"></a><input type="hidden" name="'+(t.name||t.id)+'" id="'+(t.id||t.name)+'" /></div>').appendTo($('<div style="position: relative;"></div>')).parent();var x=w.replaceWith($divInput).attr({id:"",name:""});var y=$divInput.find(":hidden");$divInput=$divInput.find(".mcdropdown").prepend(x);var z=$divInput.clone().css({position:"absolute",top:-9999999,left:-999999,visibility:"visible"}).show().appendTo("body");var A={width:z.width()-$("a",z).width(),height:z.outerHeight()};z.remove();$.data(y[0],"mcDropdown",this);$divInput.parent().height(A.height);if($.browser.safari){setTimeout(function(){w.width($divInput.width()-$("a",$divInput).width())},100)}w.width(A.width).filter(":input").attr("autocomplete","off").bind("keypress",checkKeypress).bind("mousedown",function(e){$(this).triggerHandler("focus");e.stopPropagation();return false}).bind("contextmenu",function(){return false}).bind("focus",onFocus).bind("blur",onBlur);if($.browser.msie||$.browser.safari){w.bind("keydown",function(e){if(",8,9,37,38,39,40,".indexOf(","+e.keyCode+",")>-1){return checkKeypress(e)}})}$("a",$divInput).bind("click",function(e){if(bDisabled){return false}thismenu.openMenu(e);return false});this.setValue=function(a,b){y.val(a);var c=displayString(a);if(settings.select!=null&&b!=true){settings.select.apply(thismenu,[a,c])}return w[bInput?"val":"text"](c)};if(bInput){this.setValue(w.attr("defaultValue"),true)}this.getValue=function(a){return[y.val(),w[bInput?"val":"text"]()]};this.openMenu=function(e){if($list.is(":visible")){return(!!e)?thismenu.closeMenu():false}function open(){columnizeList($list).hide();addBindings($list);anchorTo($divInput.parent(),$list,true);$list.find(".mc_hover").removeClass("mc_hover");$list[settings.openFx](settings.openSpeed,function(){scrollToView($list)});if(D&&!!$.fn.bgIframe){$list.bgIframe()}}if(e){open()}else{setTimeout(open,1)}};this.closeMenu=function(e){$list.find("ul:visible").parent().each(function(){hideBranch.apply(this)});removeBindings($list);$list[settings.closeFx](settings.closeSpeed)};this.focus=function(){w.focus()};this.disable=function(a){bDisabled=!!a;$divInput[bDisabled?"addClass":"removeClass"]("mcdropdownDisabled");x.attr("disabled",bDisabled?"disabled":"")};function getNodeText(a){return a.contents()[0]?$.trim(a.contents()[0].nodeValue):""}function getTreePath(b){if(b.length==0){return[]}var c=[getNodeText(b)];b.parents().each(function(){var a=$(this);if(this===$list[0]){return false}else{if(a.is("li")){c.push(getNodeText(a))}}});return c.reverse()}function displayValue(a){return getTreePath(getListItem(a))}function displayString(a){return displayValue(a).join(settings.delim)}function parseTree(c){var s=[],level=(arguments.length>1)?++arguments[1]:1;$("> li",c).each(function(){var a=$(this);var b=$("> ul",this);s.push({name:getNodeText(a),element:this,children:(b.length)?parseTree(b,level):[]})});return s}function addBindings(a){removeBindings(a);$("> li",a).bind("mouseover",hoverOver).bind("mouseout",hoverOut)}function removeBindings(a){$("> li",a).unbind("mouseover",hoverOver).unbind("mouseout",hoverOut)}function scrollToView(a){var p=position(a,true);var b=getScreenDimensions();if(p.bottom>b.y){$("html,body").animate({scrollTop:"+="+((p.bottom-b.y)+settings.screenPadding)+"px"})}}function hoverOver(e){var a=this;var b=$.data(a,"timer");if(!isNaN(b)){clearTimeout(b)}$(this).addClass("mc_hover");$.data(a,"timer",setTimeout(function(){showBranch.apply(a)},settings.hoverOverDelay))}function hoverOut(e){var c=this;var d=$.data(c,"timer");if(!isNaN(d)){clearTimeout(d)}$(this).removeClass("mc_hover");$.data(c,"timer",setTimeout(function(){var b=$(c);setTimeout(function(){if(b.parent().find("> li.mc_hover").length==0){b.parents("li").each(function(){var a=this;clearTimeout($.data(a,"timer"));hideBranch.apply(a);if($(this).siblings().filter(".mc_hover").length>0){return false}})}},settings.hoverOverDelay);hideBranch.apply(c)},settings.hoverOutDelay));if(D){e.stopPropagation()}}function getShadow(a){var b=w.data("shadows");if(!b){b={}}if(!b[a]){b[a]=$('<div class="mcdropdown_shadow"></div>').appendTo("body");if(!!$.fn.bgIframe){b[a].bgIframe()}w.data("shadows",b)}return b[a]}function showBranch(){var c=this;var d=$("> ul",this);if(d.is(":visible")||(d.length==0)){return false}$(this).parent().find("> li ul:visible").not(d).parent().each(function(){hideBranch.apply(this)});columnizeList(d);addBindings(d);var e=d.parents("ul").length;var f=getScreenDimensions();var g=position($(this));d.css({top:g.bottom,left:g.marginLeft}).show();var h=d.outerHeight()+d.offset().top;if(h>f.y){d.css("top",g.bottom-(h-f.y)-settings.screenPadding)}var i=function(){if(settings.dropShadow){var a=getShadow(e);var b=position(d);a.css({top:b.top+b.marginTop,left:b.left+b.marginLeft,width:b.width,height:b.height}).insertAfter(d).show();$.data(c,"shadow",a)}};if(settings.showSpeed<=0){i()}else{d.hide()[settings.showFx](settings.showSpeed,i)}}function hideBranch(){var a=$("> ul",this);if(a.is(":hidden")||(a.length==0)){return false}if(settings.dropShadow&&$.data(this,"shadow")){$.data(this,"shadow").hide()}if(D){a.css("visibility","hidden").parent().removeClass("mc_hover")}a.stop()[settings.hideFx](settings.hideSpeed)}function position(a,b){var c=false;if(a.is(":hidden")){c=!!a.css("visibility","hidden").show()}var d=$.extend(a[b===true?"offset":"position"](),{width:a.outerWidth(),height:a.outerHeight(),marginLeft:parseInt($.curCSS(a[0],"marginLeft",true),10)||0,marginRight:parseInt($.curCSS(a[0],"marginRight",true),10)||0,marginTop:parseInt($.curCSS(a[0],"marginTop",true),10)||0,marginBottom:parseInt($.curCSS(a[0],"marginBottom",true),10)||0});if(d.marginTop<0){d.top+=d.marginTop}if(d.marginLeft<0){d.left+=d.marginLeft}d.bottom=d.top+d.height;d.right=d.left+d.width;if(c){a.hide().css("visibility","visible")}return d}function anchorTo(a,b,c){var d=position(a,c);b.css({position:"absolute",top:d.bottom,left:d.left});return d.bottom}function getScreenDimensions(){var d={scrollLeft:$(window).scrollLeft(),scrollTop:$(window).scrollTop(),width:$(window).width(),height:$(window).height()};d.x=d.scrollLeft+d.width;d.y=d.scrollTop+d.height;return d}function getPadding(a,b){var c=b=="height"?"Top":"Left",borr=b=="height"?"Bottom":"Right";return(parseInt("0"+$.curCSS(a,"border"+c+"Width",true),10)+parseInt("0"+$.curCSS(a,"border"+borr+"Width",true),10)+parseInt("0"+$.curCSS(a,"padding"+c,true),10)+parseInt("0"+$.curCSS(a,"padding"+borr,true),10)+parseInt("0"+$.curCSS(a,"margin"+c,true),10)+parseInt("0"+$.curCSS(a,"margin"+borr,true),10))}function getListDimensions(a,b){if(!a.data("dimensions")){var c=$divInput.outerWidth();var d=((a===$list)&&(a.data("width")*b<c))?Math.floor(c/b):a.data("width");a.data("dimensions",{column:d,item:d-getPadding(a.children().eq(0)[0],"width"),height:a.height()})}return a.data("dimensions")}function getHeight(a){if(settings.autoHeight===false){return settings.lineHeight}if(!a.data("height")){a.data("height",a.outerHeight())}return a.data("height")}function columnizeList(f){var g=f.find("> li");var h=g.length;var j=Math.ceil(h/settings.maxRows);var k=!!arguments[1]?arguments[1]:(h<=settings.minRows)?1:(j>settings.targetColumnSize)?j:settings.targetColumnSize;var l=getListDimensions(f,k);var m=0;var n=0;var o=0;var p=Math.ceil(h/k);var q=f.parent("li").width();if(q>(l.column*k)){var r=q-l.column;l.column+=q;l.item+=r}f.css({visibility:"hidden",display:"block"});g.each(function(i){var a=i+1;var b=Math.floor((a/h)*k);var c=Math.floor((i/h)*k);var d=$(this);var e;if(m!=c){e=(n+1)*-1;n=0}else{e=0}n+=(getHeight(d)||settings.lineHeight);d.css({marginLeft:(l.column*c),marginTop:e,width:l.item})[((b>c)||(a==h))?"addClass":"removeClass"]("mc_endcol")[(e!=0)?"addClass":"removeClass"]("mc_firstrow");if(n>o){o=n}m=c});if((f!==$list)&&(o+(settings.screenPadding*2)>=getScreenDimensions().height)){return columnizeList(f,k+1)}f.css("visibility","visible").height(o);return f}function getListItem(a){return $list.find("li["+settings.valueAttr+"='"+a+"']")}function getCurrentListItem(){return getListItem(y.val())}function onFocus(e){var a=getCurrentListItem();var b=w.val().toLowerCase();var c=b.toLowerCase().split(settings.delim);var d=c.pop();var f=b.lastIndexOf(settings.delim)+1;typedText=c.join(settings.delim)+(c.length>0?settings.delim:"");setTimeout(function(){setSelection(w[0],f,f+d.length)},0);if(!$keylist){$keylist=$('<ul class="mcdropdown_autocomplete"></ul>').appendTo("body");if(D&&!!$.fn.bgIframe){$keylistiframe=$("<div></div>").bgIframe().appendTo("body")}}var g=(!settings.showACOnEmptyFocus&&(typedText.length==0));var h=(a.length==0||a.hasClass("mc_root"))?$list.find("> li"):a.parent().find("> li");showMatches(h,g)}var B;function onBlur(e){B=setTimeout(function(){var a=getCurrentListItem();if(!settings.allowParentSelect&&a.is(".mc_parent")){var b=a.find("li:not('.mc_parent'):first").attr(settings.valueAttr);thismenu.setValue(b,true)}if(settings.select!=null){settings.select.apply(thismenu,thismenu.getValue())}hideMatches()},200)}function showMatches(a,b){var c=(a===oldCache),$items=c?$keylist.find("> li").removeClass("mc_hover mc_hover_parent mc_firstrow"):a.clone().removeAttr("style").removeClass("mc_hover mc_hover_parent mc_firstrow mc_endcol").filter(":last").addClass("mc_endcol").end();if(!c||$keylist.is(":hidden")){$keylist.empty().append($items).width($divInput.outerWidth()-getPadding($keylist[0],"width")).css("height","auto");anchorTo($divInput.parent(),$keylist,true);$items.hover(function(){$keylist.find("> li").removeClass("mc_hover_parent mc_hover");$(this).addClass("mc_hover")},function(){$(this).removeClass("mc_hover")});$items.find("> ul").css("display","none");$keylist.show();if(D){var d=parseInt($keylist.css("max-height"),10)||0;if((d>0)&&(d<$keylist.height())){$keylist.height(d)}if(!!$.fn.bgIframe){anchorTo($divInput.parent(),$keylistiframe.css({height:$keylist.height(),width:$keylist.width()},true).show())}}if(b!=true){scrollToView($keylist)}}if(b===true){$keylist.css({visibility:"hidden",top:"-10000px",left:"-10000px"});if(D&&!!$.fn.bgIframe){$keylistiframe.css("display","none")}}var e=$keylist.find("li["+settings.valueAttr+"='"+y.val()+"']");e.addClass("mc_hover"+(e.is(".mc_parent")?"_parent":""));if(e.length>0&&(b!=true)){scrollIntoView(e)}oldCache=matchesCache=a}function hideMatches(){if(D&&!!$.fn.bgIframe&&$keylistiframe){$keylistiframe.hide()}if($keylist){$keylist.hide()}}function checkKeypress(e){var a=String.fromCharCode(e.keyCode||e.charCode).toLowerCase();var b=getCurrentListItem();var c=(b.length==0||b.hasClass("mc_root"))?$list.find("> li"):b.parent().find("> li");var d=typedText.split(settings.delim);var f=d.pop();var g=f+a;var h=getSelection(w[0]).toLowerCase();var i=w.val().toLowerCase();if(e.keyCode==38){moveMatch(-1);return false}else{if(e.keyCode==40){moveMatch(1);return false}else{if(e.keyCode==27){typedText="";thismenu.setValue("");showMatches($list.find("> li"));return false}else{if(e.keyCode==8||e.keyCode==37){g=(e.keyCode==37)?"":f.substring(0,f.length-1);if(h==f){f=""}if(d.length>0&&f.length==0){updateValue(b.parent().parent());return false}else{if(h==i){typedText="";thismenu.setValue("");return false}}}else{if(e.keyCode==9||e.keyCode==13||e.keyCode==39||a==settings.delim){var j=b.find("> ul > li:first");if(j.length>0){updateValue(j)}else{if($.browser.msie){setSelection(w[0],0,0)}if(e.keyCode==9){w.triggerHandler("blur");hideMatches();return true}else{w.trigger("blur");hideMatches()}}return false}else{if(h==i){typedText="";g=a}}}}}}matchesCache=findMatches(c,g);if(matchesCache.length>0){typedText=d.join(settings.delim)+(d.length>0?settings.delim:"")+g;updateValue(matchesCache.eq(0),true)}else{g=g.length?g.substring(0,g.length-1):"";matchesCache=findMatches(c,g);if(matchesCache.length>0){showMatches(matchesCache)}else{hideMatches()}}e.preventDefault();return false}function moveMatch(a){var b=getCurrentListItem(),$next,pos=0;if(b.length==0){b=matchesCache.filter(".mc_hover, .mc_hover_parent")}if(b.length==0||$keylist.is(":hidden")){b=matchesCache.eq(0);a=0}matchesCache.each(function(i){if(this===b[0]){pos=i;return false}});if(!matchesCache||matchesCache.length==0||b.length==0){return false}pos=pos+a;if(pos<0){pos=matchesCache.length-1}else{if(pos>=matchesCache.length){pos=0}}$next=matchesCache.eq(pos);updateValue($next,true)}function findMatches(b,c){var d=$([]);b.each(function(){var a=$(this),label=getNodeText(a);if(label.substring(0,c.length).toLowerCase()==c){d=d.add(a)}});return d}function updateValue(a,b){var c=b?matchesCache:(a.length==0||a.hasClass("mc_root"))?$list.find("> li"):a.parent().find("> li");var d=getTreePath(a);var e=d.pop().toLowerCase();if(!b){typedText=d.join(settings.delim).toLowerCase()+(d.length>0?settings.delim:"")}thismenu.setValue(a.attr(settings.valueAttr),true);setSelection(w[0],typedText.length,e.length+typedText.length);c.filter(".mc_hover,.mc_hover_parent").removeClass("mc_hover mc_hover_parent");a.addClass("mc_hover"+(a.is(".mc_parent")?"_parent":""));showMatches(c)}function getSelection(a){var b="";if(a.setSelectionRange){b=a.value.substring(a.selectionStart,a.selectionEnd)}else{if(document.selection){var c=document.selection.createRange();if(c.parentElement()==a){b=c.text}}}return b}function setSelection(a,b,c){if(a.createTextRange){var d=a.createTextRange();d.collapse(true);d.moveStart("character",b);d.moveEnd("character",c);d.select()}else{if(a.setSelectionRange){a.setSelectionRange(b,c)}else{if(a.selectionStart){a.selectionStart=b;a.selectionEnd=c}}}a.focus()}function scrollIntoView(a,b){var c=a[0];var d=$keylist[0];var s={pTop:parseInt($keylist.css("paddingTop"),10)||0,pBottom:parseInt($keylist.css("paddingBottom"),10)||0,bTop:parseInt($keylist.css("borderTopWidth"),10)||0,bBottom:parseInt($keylist.css("borderBottomWidth"),10)||0};if((c.offsetTop+c.offsetHeight)>(d.scrollTop+d.clientHeight)){d.scrollTop=a.offset().top+(d.scrollTop-$keylist.offset().top)-((d.clientHeight/((b==true)?2:1))-(a.outerHeight()+s.pBottom))}else{if(c.offsetTop-s.bTop-s.bBottom<=(d.scrollTop+s.pTop+s.pBottom)){d.scrollTop=a.offset().top+(d.scrollTop-$keylist.offset().top)-s.pTop}}}if(settings.init!=null){settings.init.apply(thismenu,[x,y,$list])}}})(jQuery);